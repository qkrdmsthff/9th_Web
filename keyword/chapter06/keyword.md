- `gcTime`은 무엇인가요? 🍠
    
    `gcTime` 은 데이터 캐싱 라이브러리인 **TanStack Query** 에서 사용하는 옵션입니다.
    
    `gcTime` 은 Garbage Collection Time 의 약자로, **캐시된 데이터가 더이상 사용되지 않을 때, 메모리에서 완전히 삭제되기까지 대기하는 시간**입니다.
    
    - 용도 : 메모리 관리, 불필요한 데이터를 캐시에서 제거
    - 기준 : 쿼리가 비활성 상태가 된 시점부터 타이머 시작
    - 기본값 : 5분 (1000 * 60 * 5 밀리초)
    
    ⇒ **비활성 상태**란?
    
    특정 쿼리 키 (ex. `[’todos’]`) 를 `useQuery` 등으로 사용하고 있는 컴포넌트가 화면에서 모두 사라졌을 때 (언마운트) 를 의미합니다.
    
    `gcTime` 의 동작 방식
    
    1. 최초 데이터 요청
        - 사용자가 A 페이지에 들어갑니다.
        - A 페이지의 componentA 가 이를 호출합니다.
            
            ```tsx
            useQuery({ queryKey : [’todos’], gueryFn : … });
            ```
            
        - API 에서 데이터를 가져와 `[’todos’]` 라는 키로 캐시에 저장합니다.
        - 이때 `[’todos’]` 쿼리는 활성 상태입니다. (`gcTime` 동작 X)
    2. 비활성 상태로 전환
        - 사용자가 B 페이지로 이동합니다.
        - componentA 가 언마운트 됩니다.
        - 이제 `[’todos’]` 쿼리를 사용하는 컴포넌트가 하나도 없으므로, 이 쿼리는 비활성 상태로 전환됩니다.
    3. `gcTime` 타이머 시작
        - 해당 시점부터 (비활성 상태 시작) `gcTime` 타이머가 시작됩니다.
    4. 두 가지 케이스
        1. gcTime 만료 전 (5분 이내)
            - 사용자가 3분 뒤 A 페이지로 복귀합니다.
            - componentA 가 다시 마운트 되며 `useQuery([’todos’])` 를 호출합니다.
            - React Query 는 캐시에 `[’todos’]` 가 남아있는 것을 확인합니다.
            - `gcTime` 타이머는 즉시 중지되고, 쿼리는 다시 활성 상태가 됩니다.
            - 사용자는 로딩 스피너 없이 즉시 캐시된 데이터를 보게 됩니다.
        2. gcTime 만료 후 (5분 이후)
            - 사용자가 10분 뒤 다시 A 페이지로 복귀합니다.
            - gcTime 타이머가 이미 만료되었으므로, React Query 는 캐시에 있던 `[’todos’]` 데이터를 메모리에서 완전히 삭제하였습니다.
            - componentA 가 `useQuery([’todos’])` 를 호출하면, 캐시에 데이터가 없으므로 새로운 API 요청을 시작합니다.
            - 사용자는 로딩 스피너 상태를 보게 됩니다.
- `staleTime`은 무엇인가요? 🍠
    
    `staleTime` 은 TanStack Query 에서 데이터의 ‘신선도’를 관리하는 옵션입니다.
    
    `staleTime` 은 데이터가 ‘신선한’ 상태로 유지되는 시간을 의미합니다. 
    
    - 용도 : 불필요한 API 요청을 방지합니다.
    - 기준 : 데이터가 성공적으로 가져와진 시점부터 타이머가 시작됩니다.
    - 기본값 : 0 밀리초 (0)
        
        ⇒ 이 기본값 0 이 매우 중요하며, 이는 데이터를 가져오는 즉시 ‘오래된 (stale)’ 상태로 간주한다는 의미를 지닙니다.
        
    
    `staleTime` 의 동작 방식
    
    : staleTime 을 기준으로 쿼리 데이터는 ‘fresh’ 또는 ‘stale’ 상태를 가집니다.
    
    1. `fresh` - 신선한 상태
        - 언제 : 데이터를 가져온 후 staleTime 이 아직 지나지 않았을 때
        - 동작
            - 이 쿼리를 사용하는 컴포넌트가 마운트 될 때 (페이지 재방문)
            - 윈도우가 다시 포커스 될 때 (다른 탭에 갔다가 돌아올 때)
            - 네트워크 재연결 될 때
            - 해당 세 가지 이벤트는 발생 시 API 요청을 다시 하지 않습니다.
            - React Query 는 아직 해당 데이터가 신선하다고 판단하여 캐시에 있는 데이터를 즉시 보여줍니다.
    2. `stale` - 오래된 상태
        - 언제 : staleTime 이 지났을 때
        - 동작
            - 컴포넌트 마운트, 윈도우 포커스 등의 이벤트 발생 시 React Query 는 이 데이터가 오래됐다고 판단
            - 즉시 캐시된 데이터를 먼저 UI 에 보여줌 (사용자는 로딩을 느끼지 못함)
            - 동시에 백그라운드에서 조용히 새로운 데이터를 가져오는 API 요청 실행
            - 데이터를 가져오면 기존 데이터를 새로운 데이터로 교체합니다.
    
    ⇒ 해당 전략을 Stale-While-Revalidate 라고 부르며, 사용자에게 빠른 UI 반응 속도와 데이터의 최신성 (자동 refetching) 을 모두 제공합니다.
    
    **`staleTime` 설정**
    
    1. `staleTime` 을 언제 늘려야 할지
        
        기본값 0 은 매우 공격적으로 데이터를 최신화합니다. 하지만 모든 데이터가 그럴 필요는 없습니다.
        
        - `staleTime : 1000 * 60 * 5` 5분 또는 그 이상으로 설정 :
            - 데이터가 자주 바뀌지 않을 때
            - API 요청 비용을 줄이고 싶을 때
    2. `staleTime : Infinity` 
        
        `staleTime` 을 `Infinity` 로 설정하면 데이터는 절대 `stale` 상태가 되지 않습니다.
        
        - 용도 : 정말 바뀌지 않는 정적 데이터
        - 특징 :
            - 데이터를 한 번 가져옵니다.
            - `fresh` 상태가 영원히 유지됩니다.
            - 컴포넌트 마운트, 윈도우 포커스 등 어떤 이벤트에도 절대 자동으로 리페칭되지 않습니다.
            - 데이터를 수동으로 업데이트 하여면 `queryClient.invalidateQueries` 를 호출하여 강제로 stale 하게 만들어야 합니다.
- 두 값을 어떤 식으로 설정하여야 `캐싱 전략에 유리`한가요? 🍠
    
    캐싱 전략에 유리하도록 두 값을 설정하는 것은 데이터의 특징에 따라 달라집니다.
    
    - **황금률**
        - `gcTime` 은 항상 `staleTime` 보다 길거나 같게 설정하여야 합니다.
        
        ⇒ 만약 `staleTime` 이 10분으로 설정되어 있고, `gcTime` 이 5분이면 데이터가 10분 간 신선해야 함에도 불구하고 5분 뒤 캐시에서 삭제될 수 있습니다. 
        
        (물론, React Query 가 내부적으로 `gcTime` 을 `staleTime` 만큼 강제로 늘려주긴 합니다.)
        
    1. 기본 전략 - 실시간이 중요하나, UX 가 더 중요할 때
        - `staleTime : 0`
        - `gcTime : 5분`
        
        ⇒ 가장 React Query dml 기본값이자 가장 권장되는 Stale-While-Revalidate 전략입니다.
        
    
    1. 자주 바뀌지 않는 데이터 (API 호출을 줄이고 싶을 때)
        - `staleTime : 1분 ~ 30초`
        - `gcTime : staleTime 보다 길게`
        
        ⇒ 데이터가 한 번 로드되면 일정 시간은 신선하다고 간주하는 전략입니다.
        
    2. 거의 / 절대 바뀌지 않는 데이터 (정적 데이터)
        - `staleTime : Infinity`
        - `gcTime : Infinity`
        
        ⇒ 한 번 가져온 데이터는 앱이 종료될 때까지 신선하다고 간주하는 전략입니다.
        
- `gcTime` 과 `staleTime` 비교
    
    
    | 구분 | `gcTime` | `staleTime` |
    | --- | --- | --- |
    | 목적 | 데이터를 메모리에 유지할지 삭제할지  | 데이터가 신선한지 오래되었는지 |
    | 기본값 | 5분 | 0 (즉시 stale 해짐) |
    | 타이머 | 쿼리가 비활성 상태가 될 때 | 쿼리 데이터 조회 성공 시 |
    | 결과 | 타이머 만료 시 데이터를 캐시에서 완전히 삭데 | stale 상태일 때 특정 조건이 되면 데이터를 다시 가져옴 |